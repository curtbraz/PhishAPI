var Cpc;!function(t){var i=function(){function t(){this.accountNumber="",this.autoSavePayment=!1,this.autoValidate=!1,this.cardTypeListFlag=2,this.collectAddress=!0,this.contextCountry="",this.ipAddress="",this.numPackages=0,this.profileCountry="",this.repop=!1,this.rifAppId="",this.rifPrefix="",this.serviceLevelCode="",this.showBillingName=!1,this.showDefaultFlag=!0,this.showProfileRadio=!1,this.showShipFrom=!1,this.status=0,this.tAccount="",this.trackingNumber="",this.transactionSource="",this.useFloorLimits=!1,this.validateAvs=!1,this.showVatId=!1}return t}();t.WidgetOptions=i;var s=function(){function t(){}return t}();t.PaymentCard=s;var e=function(){function t(){this.cardNumberMax=19,this.cvvMax=4,this.cvvMin=3,this.nicknameMax=35,this.vatIdMax=11,this.nifIdMax=9,this.italyTaxIdBusiness=13,this.italyTaxIdPersonal=16,this.email=50}return t}();t.FieldLengths=e;var a=function(){function t(){this.numbersOnly="^[0-9]+$",this.nickname="^[a-zA-Z0-9 ]+$",this.portugalVatId="(^(PT|pt|pT|Pt)[0-9]{9}$)|(^(?!PT)(?!pt)(?!Pt)(?!pT)[a-zA-Z0-9]+$)",this.spainVatId="(^(ES|es|eS|Es)([0-9]{1}[a-zA-Z0-9]{7}[a-zA-Z]{1}|[a-zA-Z]{1}[a-zA-Z0-9]{7}[a-zA-Z0-9]{1})+$)",this.spainNifId="(^((?![iotIOT])[a-zA-Z0-9]{1}[a-zA-Z0-9]{7}(?![iouñIOUÑ])[a-zA-Z0-9]{1})+$)",this.email="^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$",this.freeFormTextLatin1="^[a-zA-Z0-9- '.*?/\n/,\\\\()~:#\\[\\]\"+$=!~@&_/-ÿ]+$",this.alphaNumeric="^[a-zA-Z0-9]+$",this.countryList="[()',. ]"}return t}();t.RegEx=a;var n=function(){function t(t,i,s,e,a){void 0===s&&(s=!1),void 0===e&&(e=!1),void 0===a&&(a=!1),this["@type"]=t["@type"],this.billingAddress=t.billingAddress,this.key=t.key,this.validateAVS=t.validateAVS,this.chargeTypeCode=t.chargeTypeCode,this.paymentMediaTypeCode=t.paymentMediaTypeCode,this.isDefault=t.isDefault,this.countryCode=t.countryCode,this.options=new r(i,s,e,a),this.cardNumber=t.cardNumber,this.cvv=t.cvv,this.expiryMonth=t.expiryMonth,this.expiryYear=t.expiryYear,this.cardType=t.cardType,this.accountName=t.accountName,this.nickName=t.nickName,this.taxId=t.taxId,this.taxIdTypeCode=t.taxIdTypeCode,this.sdiSystemCode=t.sdiSystemCode,this.pecEmailAddress=t.pecEmailAddress,this.processingCountryCode=t.processingCountryCode}return t}();t.PaymentRequest=n;var r=function(){function t(t,i,s,e){void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===e&&(e=!1),this.userId=t.userId,this.transactionId=t.transactionId,this.rifAppId="CPC",this.rifPrefix="cpcWidget",this.defaultPaymentMethod=s,this.storePaymentMethod=i,this.iobb=t.iobb,this.originAddress={},this.destinationAddress={},this.validateAddress=!0,e&&(this.storeBA=!0,this.createBA=!0)}return t}();t.PaymentRequestOptions=r;var o=function(){function t(){}return t}();t.BillingAddress=o;var d=function(){function t(t){this.addressLine1=t.address1,this.addressLine2=t.address2,this.addressLine3=t.address3,this.city=t.city,this.country=t.country,this.state=t.state,this.postalCode=t.postal,this.lastName=t.name}return t}();t.RequestBillingAddress=d;var h=function(){function t(){this["@type"]="",this.billingAddress=new d(new o)}return t}();t.Payment=h;var c=function(){function t(){}return t}();t.Country=c;var u=function(){function t(t,i,s){this.id=t,this.displayText=i,this.type=s}return t}();t.FormError=u;var p;!function(t){t[t.None=0]="None",t[t.Vat=1]="Vat",t[t.Nif=2]="Nif",t[t.Pfc=3]="Pfc"}(p=t.TaxIdType||(t.TaxIdType={}))}(Cpc||(Cpc={}));
var Cpc;!function(e){var t="Card",r="PayPal",a="UPSAcct",n="APM",d="newCard",s="newPayPal",o="newAPM",y="02",p="97",i="12",u="CARD",c="PAYPAL",l="HPP",m="PT",C="ES",f=11,P=9,g="(^(ES|es|eS|Es)([0-9]{1}[a-zA-Z0-9]{7}[a-zA-Z]{1}|[a-zA-Z]{1}[a-zA-Z0-9]{7}[a-zA-Z0-9]{1})+$)",h="(^((?![iotIOT])[a-zA-Z0-9]{1}[a-zA-Z0-9]{7}(?![iouñIOUÑ])[a-zA-Z0-9]{1})+$)",w=function(){function w(){}return w.prototype.existingPayment=function(e){return e.existingPaymentCard||e.existingPayPalAccount||e.existingUPSAccount||e.existingHPP},w.prototype.filterPaymentMethods=function(e,y,p){var i=[];if(null!=e)for(var m=0;m<e.length;m++)e[m]["@type"]===t&&y.existingPaymentCard?i.push(e[m]):e[m]["@type"]===r&&y.existingPayPalAccount?i.push(e[m]):e[m]["@type"]===a&&y.existingUPSAccount?i.push(e[m]):e[m]["@type"]===n&&y.existingHPP&&i.push(e[m]);for(var C=!1,f=!1,P=!1,m=0;m<p.length;m++)p[m].paymentType===u&&(C=!0),p[m].paymentType===c&&(f=!0),p[m].paymentType===l&&(P=!0);return C&&y.newPaymentCard&&i.push({"@type":d,displayableCardNumber:y.newPaymentCardText}),f&&y.newPayPalAccount&&i.push({"@type":s,accountName:y.newPayPalAccountText}),P&&y.newHPP&&i.push({"@type":o,nickName:y.newHPPText}),i},w.prototype.getExistingPaymentMethods=function(e){return e.filter(function(e){return e["@type"]===t||e["@type"]===r||e["@type"]===a||e["@type"]===n})},w.prototype.paymentMethodDisplay=function(e,n){if(e["@type"]===t){for(var o=null,y=0;y<n.length;y++)if(e.wwcr===n[y].wwcr){o=n[y].displayName;break}return null!=o?o+" - "+e.displayableCardNumber:e.displayableCardNumber}return e["@type"]===d?e.displayableCardNumber:e["@type"]===r||e["@type"]===s?e.accountName:e["@type"]===a?e.accountNumber+" - "+e.accountName:e.nickName},w.prototype.numberFilter=function(e){8===e.keyCode||9===e.keyCode||13===e.keyCode||37===e.keyCode||39===e.keyCode||38===e.keyCode||40===e.keyCode||e.shiftKey&&9===e.keyCode||e.ctrlKey&&(86===e.keyCode||90===e.keyCode||88===e.keyCode||67===e.keyCode||65===e.keyCode||89===e.keyCode)||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=96&&e.keyCode<=105||e.preventDefault()},w.prototype.getYearList=function(){for(var e=[],t=(new Date).getFullYear(),r=t;r<t+10;r++)e.push(r);return e},w.prototype.getMonthList=function(){for(var e=[],t=1,r=t;r<=12;r++)e.push(r);return e},w.prototype.getNewCardPaymentMethod=function(r,a){var n=new e.Payment;return n["@type"]=t,n.cardNumber=r.cardNumber,n.cvv=r.cvv,n.expiryMonth=r.month,n.expiryYear=r.year,n.paymentMediaTypeCode=y,n.key=r.key,n.billingAddress=new e.RequestBillingAddress(a),n.cardType=r.cardType.id,n.chargeTypeCode=n.cardType.substr(3,2),n},w.prototype.getPaymentCardForEdit=function(t,r){var a=new e.PaymentCard;a.year=t.expiryYear,a.month=t.expiryMonth,a.cardNumber=t.displayableCardNumber,a.key=t.key;for(var n=0;n<r.length;n++)if(r[n].wwcr===t.cardType){a.cardType=r[n];break}return a},w.prototype.getBillingAddressForUi=function(t){var r=new e.BillingAddress;return r.name=t.firstName+" "+t.lastName,r.address1=t.addressLine1,r.address2=t.addressLine2,r.address3=t.addressLine3,r.city=t.city,r.state=t.state,r.postal=t.postalCode,r.country=t.country,r},w.prototype.getCacAddressObject=function(e){return{contact:{name:e.firstName+" "+e.lastName},address:{address1:e.addressLine1,address2:e.addressLine2,address3:e.addressLine3,city:e.city,state:{key:e.state},postal:e.postalCode,country:{key:e.country}}}},w.prototype.getBillingAddressFromCac=function(t){var r=new e.BillingAddress;return r.name=t.contact.name,r.contact=t.contact.contactName,r.address1=t.address.address1,r.address2=t.address.address2,r.address3=t.address.address3,r.city=t.address.city,r.state=null!=t.address.state?t.address.state.key:null,r.postal=t.address.postal,r.country=t.address.country.key,r},w.prototype.getNewPayPalPaymentMethod=function(t,a){void 0===a&&(a=null);var n=new e.Payment;return n["@type"]=r,n.chargeTypeCode=p,n.paymentMediaTypeCode=i,null!=a&&(n.accountName=a),n},w.prototype.isEditMode=function(e){return null!=e.accountKey&&""!==e.accountKey},w.prototype.getNewAlternatePaymentMethod=function(t,r,a){void 0===a&&(a=null);var d=new e.Payment;return d["@type"]=n,d.chargeTypeCode=p,d.paymentMediaTypeCode=t.wwcr,d.billingAddress=new e.RequestBillingAddress(r),null!=a&&(d.nickName=a),d},w.prototype.getCardNumberMinLength=function(e){if(!e)return 16;switch(e.wwcr){case"06":case"19":return 13;case"01":return 15;case"16":return 12;default:return 16}},w.prototype.addressExists=function(e){return null!=e&&null!=e.country&&""!==e.country&&null!=e.country&&""!==e.country},w.prototype.validTaxId=function(t,r){if(r===e.TaxIdType.Vat&&t.substr(0,2).toUpperCase()!==m&&t.substr(0,2).toUpperCase()!==C)return!0;if(r===e.TaxIdType.Vat&&t.length<f)return!1;if(r===e.TaxIdType.Nif&&t.length<P)return!1;if(r===e.TaxIdType.Vat&&t.substr(0,2).toUpperCase()===m){for(var a=0,n=2,d=9;n<10;n++,d--)a+=parseInt(t[n])*d;var s=11-a%11;return s>=10&&(s=0),parseInt(t[10])===s}return r===e.TaxIdType.Vat&&t.substr(0,2).toUpperCase()===C?RegExp(g).test(t):r===e.TaxIdType.Nif?RegExp(h).test(t):void 0},w}();e.Utility=w}(Cpc||(Cpc={}));
var Cpc;!function(t){var e="cpcws/api/v2/payments",n="cpcws/api/v2/upsclients/init",s="cpcws/api/v1/users/defaultTransId",r="/methods?",i="/store",a="/types/",o="application/json",p="PayPal",u=function(){function u(t,e){this.$http=t,this.utility=e}return u.prototype.getPaymentMethods=function(t,n){void 0===n&&(n=!1);var s=this.getBaseUrl(t)+e+r;return null!=t.userId&&""!==t.userId&&(s+="userId="+t.userId+"&"),s+="defaultOnly=false&",s+="paymentFilters=true%2Ctrue%2Ctrue%2Ctrue&",null!=t.country&&(s+="country="+t.country),this.$http.get(s,this.getHttpConfig(t))},u.prototype.initialize=function(e){var s=this.getBaseUrl(e)+n;null!=e.transactionId&&(s+="?transId="+e.transactionId);var r=new t.WidgetOptions;return angular.copy(e,r),delete r.useCookies,delete r.shipFromAddress,delete r.paymentMethodText,delete r.newPaymentCardText,delete r.newPayPalAccountText,delete r.newHPPText,delete r.cacwsBaseUri,delete r.templateString,delete r.cacTemplateString,delete r.billingCountries,delete r.processingCountries,delete r.hasAssociatedAccount,this.$http.post(s,JSON.stringify(r),this.getHttpConfig(e))},u.prototype.saveToProfile=function(n,s,r){var i=this.getBaseUrl(s)+e+"/"+s.transactionId,a=n["@type"]===p,o=new t.PaymentRequest(n,s,(!0),r,a);return this.$http.post(i,JSON.stringify(o),this.getHttpConfig(s))},u.prototype.storePayment=function(n,s,r){var a,o=this.getBaseUrl(s)+e+"/"+s.transactionId+i;switch(r){case"1":a=new t.PaymentRequest(n,s,(!0));break;case"2":a=new t.PaymentRequest(n,s,(!0),(!0));break;default:a=new t.PaymentRequest(n,s)}return this.$http.post(o,JSON.stringify(a),this.getHttpConfig(s))},u.prototype.getPaymentTypes=function(t){var n=this.getBaseUrl(t)+e+a+t.country;return this.$http.get(n,this.getHttpConfig(t))},u.prototype.getProfileAddress=function(t){var e=this.getBaseUrl(t)+s;return null!=t.userId&&""!==t.userId&&(e+="?userId="+t.userId),this.$http.get(e,this.getHttpConfig(t))},u.prototype.getBaseUrl=function(t){var e="/";return null!=t.cpcwsBaseUri&&(e=t.cpcwsBaseUri),e},u.prototype.getHttpConfig=function(t){return{headers:{"X-UPSCPC-REST-App-Id":t.appId,"X-UPSCPC-REST-API-Token":t.token,"Content-Type":o},withCredentials:t.useCookies}},u.$inject=["$http","CpcUtility"],u}();t.Http=u}(Cpc||(Cpc={}));
var Cpc;!function(t){var e=1,i=2,s="unauthorized",n="invalid",a="Card",o="PayPal",h="APM",r="newCard",d="newPayPal",y="newAPM",p="PT",c="ES",l="IT",u="VAT",m="NIF",P="0001",f="0005",T=function(){function T(e,i,s){var n=this;this.$scope=e,this.utility=i,this.http=s,this.render=!1,this.validate=!1,this.sameAddress=!0,this.showPaymentCard=!1,this.showExternalPayment=!1,this.showAlternate=!1,this.editMode=!1,this.makeDefault=!1,this.externalPaymentNickname="",this.showSaveOption=!1,this.loggedIn=!1,this.cacApi={},this.cacOptions={},this.apiObject={},this.hasProfileAddress=!1,this.hasShipFromAddress=!1,this.showPaymentMethods=!0,this.taxIdType=t.TaxIdType.Vat,this.taxIdTypeOptions={vat:t.TaxIdType.Vat,nif:t.TaxIdType.Nif,none:t.TaxIdType.None},this.italyTaxIdType=u,this.italyTaxIdNumber="",this.italyTaxIdEmail="",this.italySdiCode="",this.cacInitCallback=function(t){n.cacApi=t,n.cacOptions.userID=n.options.userId,n.cacOptions.cacwsBaseUri=n.options.cacwsBaseUri,n.cacOptions.locale=n.options.locale,n.cacOptions.addressType="origin",n.cacOptions.useFullWidth=!0,n.cacOptions.showUpdateEntry=function(){return!1},n.cacOptions.showSaveEntry=function(){return!1},n.cacOptions.showUseAsDefault=function(){return!1},n.cacOptions.showTopNickname=function(){return!1},n.cacOptions.showPhoneType=function(){return!1},n.cacOptions.showFax=function(){return!1},n.cacOptions.showLocationId=function(){return!1},n.cacOptions.showIsResidential=function(){return!1},n.cacOptions.showEmailNotify=function(){return!1},n.cacOptions.showEmail=function(){return!1},n.cacOptions.showPhone=function(){return!1},n.cacOptions.showExtension=function(){return!1},n.cacOptions.templateString=n.options.cacTemplateString,n.cacOptions.countries=n.options.billingCountries,n.cacApi.init(n.cacOptions)},this.lengths=new t.FieldLengths,this.regex=new t.RegEx,this.registerExternalApis()}return T.prototype.registerExternalApis=function(){var t=this;this.apiObject.init=function(e){try{t.init(e)}catch(t){}},this.apiObject.storeAndValidatePayment=function(e,i){try{t.storeAndValidatePayment(e,i)}catch(t){}},this.apiObject.saveToProfile=function(e,i){try{t.saveToProfile(e,i)}catch(t){}},this.apiObject.validateClient=function(){try{return t.validateClient()}catch(t){return!1}},this.apiObject.getClientErrorList=function(){try{return t.getClientErrorList()}catch(t){return[]}},this.apiObject.getSupportedPaymentTypes=function(e,i,s){try{t.getSupportedPaymentTypes(e,i,s)}catch(t){}}},T.prototype.init=function(t){var e=this;this.options=t,this.loadTemplate(t.templateString),this.hasShipFromAddress=this.utility.addressExists(t.shipFromAddress),this.http.initialize(this.options).then(function(){e.getPaymentTypes()},function(t){})},T.prototype.getPaymentTypes=function(){var t=this;this.http.getPaymentTypes(this.options).then(function(e){t.paymentTypes=e.data.paymentTypes,t.getProfileAddress()},function(t){})},T.prototype.getSupportedPaymentTypes=function(t,e,i){this.http.getPaymentTypes(t).then(function(t){e(t)},function(t){i(t)})},T.prototype.getProfileAddress=function(){var t=this;this.http.getProfileAddress(this.options).then(function(e){t.loggedIn=!0,t.profileAddress=t.utility.getBillingAddressForUi(e.data),t.hasProfileAddress=t.utility.addressExists(t.profileAddress),t.hasProfileAddress&&t.profileAddress.country!==t.options.country&&(t.sameAddress=!1,t.cacOptions.address={country:{key:t.options.country}})},function(t){}).finally(function(){t.initUi()})},T.prototype.initUi=function(){this.render=!0,this.options.uiType===e?this.initPaymentMethods():this.utility.isEditMode(this.options)?(this.editMode=!0,this.initEditPaymentMethod(this.options)):this.initAddPaymentMethod(this.options)},T.prototype.initAddPaymentMethod=function(t){t.newPaymentCard?(this.addModeType=a,this.showPaymentCard=!0):t.newPayPalAccount?(this.addModeType=o,this.externalPaymentText=o,this.showExternalPayment=!0):t.newHPP&&(this.addModeType=h,this.showAlternate=!0)},T.prototype.initEditPaymentMethod=function(t){var e=this;this.http.getPaymentMethods(this.options,!0).then(function(i){e.existingPaymentMethod=null;for(var s=0;s<i.data.payments.length;s++)if(i.data.payments[s].key===t.accountKey){e.existingPaymentMethod=i.data.payments[s];break}if(null!=e.existingPaymentMethod)if(e.makeDefault=e.existingPaymentMethod.default,e.sameAddress=e.existingPaymentMethod.billingAddress.profileAddress,e.existingPaymentMethod["@type"]===a){e.paymentCard=e.utility.getPaymentCardForEdit(e.existingPaymentMethod,e.paymentTypes);var n=e.utility.getCacAddressObject(e.existingPaymentMethod.billingAddress);null!=n.address.country.key&&""!==n.address.country.key||(n.address.country.key=e.existingPaymentMethod.countryCode),e.cacOptions.address=n.address,e.cacOptions.contact=n.contact,e.showPaymentCard=!0}else if(e.existingPaymentMethod["@type"]===o)e.externalPaymentNickname=e.existingPaymentMethod.accountName,e.showExternalPayment=!0;else if(e.existingPaymentMethod["@type"]===h){e.showAlternate=!0;for(var s=0;s<e.paymentTypes.length;s++)if(e.paymentTypes[s].wwcr===e.existingPaymentMethod.wwcr){e.alternatePaymentType=e.paymentTypes[s];break}e.showExternalPayment=!0,e.externalPaymentNickname=e.existingPaymentMethod.nickName}},function(t){})},T.prototype.saveToProfile=function(e,i){var s=this;if(this.validateClient()){var n=new t.Payment;this.editMode?this.existingPaymentMethod["@type"]===a?n=this.utility.getNewCardPaymentMethod(this.paymentCard,this.getBillingAddress()):this.existingPaymentMethod["@type"]===o?(n=this.existingPaymentMethod,n.accountName=this.externalPaymentNickname):this.existingPaymentMethod["@type"]===h&&(n=this.existingPaymentMethod,n.nickName=this.externalPaymentNickname):this.options.newPaymentCard?n=this.utility.getNewCardPaymentMethod(this.paymentCard,this.getBillingAddress()):this.options.newPayPalAccount?n=this.utility.getNewPayPalPaymentMethod(this.options,this.externalPaymentNickname):this.options.newHPP&&(n=this.utility.getNewAlternatePaymentMethod(this.alternatePaymentType,this.getBillingAddress(),this.externalPaymentNickname)),n.taxId=this.taxId,this.taxId&&(n.taxIdTypeCode=this.getTaxIdTypeCode(),n.pecEmailAddress=this.italyTaxIdEmail,n.sdiSystemCode=this.italySdiCode,this.options.newPayPalAccount&&this.italyTaxIdNumber&&(n.processingCountryCode=this.italyTaxIdCountry.key)),this.http.saveToProfile(n,this.options,this.makeDefault).then(function(t){t.data.redirectRequired?window.location.href=t.data.authorization.redirectURI:e(t)},function(t){s.mapError(t),i(t)})}},T.prototype.initPaymentMethods=function(){var t=this;this.loggedIn&&this.utility.existingPayment(this.options)?this.http.getPaymentMethods(this.options).then(function(e){t.paymentMethods=[],t.paymentMethods=t.utility.filterPaymentMethods(e.data.payments,t.options,t.paymentTypes);for(var i=0;i<t.paymentMethods.length;i++)if(t.paymentMethods[i].default){t.selectedPaymentMethod=t.paymentMethods[i];break}t.adjustPaymentMethodsIfNeeded()},function(t){}):(this.paymentMethods=this.utility.filterPaymentMethods(null,this.options,this.paymentTypes),this.adjustPaymentMethodsIfNeeded())},T.prototype.adjustPaymentMethodsIfNeeded=function(){if(1===this.paymentMethods.length&&this.paymentMethods[0]["@type"]!==o)this.selectedPaymentMethod=this.paymentMethods[0],this.methodChange(),this.showPaymentMethods=!1,this.hideAlternatePaymentMethodDropdownIfNeeded();else{var t=this.utility.getExistingPaymentMethods(this.paymentMethods);if(1===t.length){var e=this.paymentMethods.map(function(t){return t["@type"]}).indexOf(t[0]["@type"]);this.selectedPaymentMethod=this.paymentMethods[e],this.methodChange()}}},T.prototype.hideAlternatePaymentMethodDropdownIfNeeded=function(){if(this.selectedPaymentMethod["@type"]===y){var t=this.paymentTypes.filter(function(t){return"HPP"===t.paymentType});1===t.length&&(this.alternatePaymentType=t[0],this.showExternalPayment=!0)}},T.prototype.validateClient=function(){return this.validate=!0,this.showTaxId()&&null!=this.taxId&&""!==this.taxId&&!this.utility.validTaxId(this.taxId,this.taxIdType)&&this.$scope.cpcForm.taxId.$setValidity(n,!1),this.usingCac()?this.cacApi.formValid()&&this.$scope.cpcForm.$valid:this.$scope.cpcForm.$valid},T.prototype.getBillingAddress=function(){return this.sameAddressAvailable()&&this.sameAddress?this.useProfileAddress()?this.profileAddress:this.options.shipFromAddress:this.utility.getBillingAddressFromCac(this.cacApi.getData())},T.prototype.storeAndValidatePayment=function(t,e){var i=this;if(this.validateClient()){var s=this.selectedPaymentMethod;this.selectedPaymentMethod["@type"]===r?s=this.utility.getNewCardPaymentMethod(this.paymentCard,this.getBillingAddress()):this.selectedPaymentMethod["@type"]===d?s=this.utility.getNewPayPalPaymentMethod(this.options):this.selectedPaymentMethod["@type"]===y&&(s=this.utility.getNewAlternatePaymentMethod(this.alternatePaymentType,this.getBillingAddress())),s.taxId=this.taxId,this.taxId&&(s.taxIdTypeCode=this.getTaxIdTypeCode(),s.pecEmailAddress=this.italyTaxIdEmail,s.sdiSystemCode=this.italySdiCode,this.selectedPaymentMethod["@type"]===d&&this.italyTaxIdNumber&&(s.processingCountryCode=this.italyTaxIdCountry.key)),this.http.storePayment(s,this.options,this.saveOption).then(function(e){t(e)},function(t){i.mapError(t),e(t)})}},T.prototype.methodChange=function(){this.showPaymentCard=this.selectedPaymentMethod["@type"]===r,this.showAlternate=this.selectedPaymentMethod["@type"]===y,this.showExternalPayment=this.selectedPaymentMethod["@type"]===d,this.showSaveOption=this.selectedPaymentMethod["@type"]===r||this.selectedPaymentMethod["@type"]===y||this.selectedPaymentMethod["@type"]===d,this.selectedPaymentMethod["@type"]===d&&(this.externalPaymentText=o),this.selectedPaymentMethod["@type"]===y&&null!=this.alternatePaymentType&&(this.externalPaymentText=this.alternatePaymentType.displayName,this.showExternalPayment=!0)},T.prototype.mapError=function(t){switch(t.data.processingError.code){case"7101":this.$scope.cpcForm.cvv.$setValidity(s,!1);break;case"39052":this.$scope.cpcForm.nickname.$setValidity(n,!1);break;case"39015":this.$scope.cpcForm.cardNumber.$setValidity(n,!1)}},T.prototype.resetServerValidation=function(t){switch(t){case"cvv":this.$scope.cpcForm.cvv.$setValidity(s,!0);break;case"nickname":this.$scope.cpcForm.nickname.$setValidity(n,!0);break;case"cardNumber":this.$scope.cpcForm.cardNumber.$setValidity(n,!0);break;case"taxId":this.$scope.cpcForm.taxId.$setValidity(n,!0)}},T.prototype.showBillingAddress=function(){return!this.paymentMethodIsPayPal()&&(this.showPaymentCard||this.showExternalPayment)},T.prototype.paymentMethodIsPayPal=function(){return!(!this.selectedPaymentMethod||this.options.uiType!==e||this.selectedPaymentMethod["@type"]!==o&&this.selectedPaymentMethod["@type"]!==d)||!(this.options.uiType!==i||!(this.addModeType===o||this.addModeType===d||this.editMode&&this.existingPaymentMethod&&this.existingPaymentMethod["@type"]===o))},T.prototype.setExternalPayment=function(t){this.externalPaymentText=t,this.showExternalPayment=!0},T.prototype.showPayPalIcon=function(){return this.addModeType===o||this.editMode&&this.existingPaymentMethod["@type"]===o||this.options.uiType===e&&"newPayPal"===this.selectedPaymentMethod["@type"]},T.prototype.usingCac=function(){return(!this.sameAddressAvailable()||!this.sameAddress)&&this.showBillingAddress()},T.prototype.getClientErrorList=function(){var e=[],i=this.$scope.cpcForm.$error;for(var s in i)if(i.hasOwnProperty(s)&&Array.isArray(i[s]))for(var n=0;n<i[s].length;n++)if("cacForm"!==i[s][n].$name){var a=angular.element("[name="+i[s][n].$name+"]").attr("id"),o=angular.element("label[for="+a+"]")[0];e.push(new t.FormError(a,o.innerText,s))}if(this.usingCac()&&!this.cacApi.formValid())for(var h=this.cacApi.getFormErrors(),n=0;n<h.length;n++){var a=angular.element("[name="+h[n].fieldName+"]").attr("id"),o=angular.element("label[for="+a+"]")[0];e.push(new t.FormError(a,o.innerText,h[n].fieldError))}return e},T.prototype.useProfileAddress=function(){return this.loggedIn&&this.hasProfileAddress},T.prototype.sameAddressAvailable=function(){return this.useProfileAddress()||this.hasShipFromAddress},T.prototype.showVatIdForPortugal=function(){return(this.hasProfileAddress&&this.profileAddress.country===p||!this.loggedIn&&this.options.country===p)&&(this.showExternalPayment||this.showPaymentCard)},T.prototype.showTaxIdType=function(){if(this.options.country===c)switch(this.options.uiType){case e:return this.selectedPaymentMethod&&(this.selectedPaymentMethod["@type"]===r||this.selectedPaymentMethod["@type"]===d||this.selectedPaymentMethod["@type"]===y);case i:return this.addModeType===o||this.addModeType===a||this.addModeType===h||this.editMode}return!1},T.prototype.getTaxIdTypeText=function(){return this.taxIdType===t.TaxIdType.Nif?m:u},T.prototype.getTaxIdMaxLength=function(){return this.showTaxIdType()&&this.taxIdType===t.TaxIdType.Nif?this.lengths.nifIdMax:this.lengths.vatIdMax},T.prototype.getTaxIdPattern=function(){return this.showTaxIdType()?this.taxIdType===t.TaxIdType.Vat?this.regex.spainVatId:this.regex.spainNifId:this.regex.portugalVatId},T.prototype.showTaxId=function(){return this.showVatIdForPortugal()||this.showTaxIdType()&&(this.taxIdType===t.TaxIdType.Vat||this.taxIdType===t.TaxIdType.Nif)},T.prototype.taxIdRequired=function(){return this.showTaxIdType()},T.prototype.getTaxIdTypeCode=function(){var e="";switch(this.taxIdType){case t.TaxIdType.Nif:case t.TaxIdType.Pfc:e=f;break;default:e=P}return e},T.prototype.showItalyTaxIdSection=function(){return this.options.uiType===e?this.options.country===l&&!this.options.hasAssociatedAccount:(this.options.country===l||this.hasProfileAddress&&this.profileAddress.country===l)&&(this.options.newPaymentCard||this.options.newPayPalAccount)},T.prototype.showItalyTaxIdProcessingCountries=function(){return this.options.newPayPalAccount},T.prototype.getItalyTaxIdLength=function(){return this.italyTaxIdType===u?this.lengths.italyTaxIdBusiness:this.lengths.italyTaxIdPersonal},T.prototype.isItalyTaxIdRequired=function(){return this.addModeType===o?this.italyTaxIdCountry&&this.italyTaxIdCountry.key===l:this.getBillingAddress().country===l},T.prototype.isItalyTaxIdVat=function(){return this.italyTaxIdType===u},T.prototype.italyTaxIdTypeChanged=function(){this.taxIdType=this.italyTaxIdType===u?t.TaxIdType.Vat:t.TaxIdType.Pfc},T.prototype.italyTaxIdNumberChanged=function(){this.taxId=this.italyTaxIdNumber},T.prototype.getProcessingCountryInitValue=function(){return this.options.processingCountries.filter(function(t){return t.key===l})[0]},T.$inject=["$scope","CpcUtility","CpcHttp"],T}();t.CpcCtrl=T}(Cpc||(Cpc={}));
var Cpc;!function(t){var n=function(){function n(n){var r=this;this.$compile=n,this.restrict="E",this.controllerAs="cpc",this.controller=t.CpcCtrl,this.bindToController=!0,this.scope={initCallback:"="},this.link=function(t,n){t.cpc.loadTemplate=function(i){n.html(i),r.$compile(n.contents())(t)},t.cpc.initCallback&&t.cpc.initCallback(t.cpc.apiObject)}}return n.factory=function(){var t=function(t){return new n(t)};return t.$inject=["$compile"],t},n}();t.CpcDirective=n;var r=function(){function t(){this.restrict="A",this.require="ngModel",this.link=function(t,n,r,i){i.$parsers.push(function(t){var n="";return t&&(n=t,n=n.replace(/[^\d]/g,"")),n!==t&&(i.$setViewValue(n),i.$render()),""===n?null:"number"==typeof t?parseFloat(n):n})}}return t.factory=function(){var n=function(){return new t};return n},t}();t.NumericInput=r;var i=function(){function n(){this.restrict="A",this.require="ngModel",this.scope={italyVatIdValidation:"="},this.link=function(n,r,i,e){e.$validators.italyVatIdPattern=function(r,i){if(e.$isEmpty(r))return!0;if(n.italyVatIdValidation){if("IT"!==i.substr(0,2))return!1;if(!new RegExp((new t.RegEx).alphaNumeric).test(i))return!1;for(var c=0,a=0,o=2;o<i.length;o++){var u=o+1,l=parseInt(i.charAt(o));u%2===0?u<13&&(l*=2,l>9&&(l-=9),a+=l):u<12&&l&&(c+=l)}var s=c+a,p=parseInt(s.toString().charAt(s.toString().length-1)),f=0;if(!p)return!1;f=10-p;var h=parseInt(i.charAt(i.length-1));return h&&f===h}return new RegExp((new t.RegEx).alphaNumeric).test(i)}}}return n.factory=function(){var t=function(){return new n};return t},n}();t.ItalyVatIdValidation=i}(Cpc||(Cpc={}));
var Cpc;!function(t){angular.module("upsCpcModule",["ngMessages","upsCacModule"]).directive("upsCpc",t.CpcDirective.factory()).directive("numericInput",t.NumericInput.factory()).directive("italyVatIdValidation",t.ItalyVatIdValidation.factory()).controller(t.CpcCtrl).service("CpcHttp",t.Http).service("CpcUtility",t.Utility)}(Cpc||(Cpc={}));